<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>K8s Observability – Validation Report</title>
<style>
  :root {
    --bg: #0d1117;
    --surface: #161b22;
    --border: #30363d;
    --text: #c9d1d9;
    --text-dim: #8b949e;
    --accent: #58a6ff;
    --green: #3fb950;
    --red: #f85149;
    --yellow: #d29922;
    --cyan: #39d2c0;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    padding: 2rem;
  }
  .container { max-width: 1100px; margin: 0 auto; }
  h1 { font-size: 1.8rem; margin-bottom: .25rem; }
  h2 { font-size: 1.3rem; margin: 2rem 0 .75rem 0; color: var(--accent); border-bottom: 1px solid var(--border); padding-bottom: .4rem; }
  .subtitle { color: var(--text-dim); font-size: .9rem; margin-bottom: 1.5rem; }

  /* ── Stats cards ─────────────────────────────────── */
  .stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }
  .stat-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1rem 1.2rem;
    text-align: center;
  }
  .stat-card .value { font-size: 2rem; font-weight: 700; }
  .stat-card .label { font-size: .8rem; text-transform: uppercase; color: var(--text-dim); letter-spacing: .5px; }
  .stat-card.pass  .value { color: var(--green); }
  .stat-card.fail  .value { color: var(--red); }
  .stat-card.warn  .value { color: var(--yellow); }
  .stat-card.fix   .value { color: var(--cyan); }

  /* ── Table ───────────────────────────────────────── */
  table {
    width: 100%;
    border-collapse: collapse;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
    margin-bottom: 1.5rem;
  }
  th, td { padding: .65rem 1rem; text-align: left; border-bottom: 1px solid var(--border); }
  th { background: rgba(88,166,255,.08); font-weight: 600; font-size: .85rem; text-transform: uppercase; letter-spacing: .3px; }
  tr:last-child td { border-bottom: none; }
  tr:hover { background: rgba(88,166,255,.04); }

  /* status badges */
  .badge {
    display: inline-block;
    padding: 2px 10px;
    border-radius: 12px;
    font-size: .78rem;
    font-weight: 600;
    text-transform: uppercase;
  }
  .badge-pass { background: rgba(63,185,80,.15); color: var(--green); }
  .badge-fail { background: rgba(248,81,73,.15); color: var(--red); }
  .badge-warn { background: rgba(210,153,34,.15); color: var(--yellow); }
  .badge-skip { background: rgba(139,148,158,.15); color: var(--text-dim); }

  .badge-imported { background: rgba(63,185,80,.15); color: var(--green); }
  .badge-skipped  { background: rgba(210,153,34,.15); color: var(--yellow); }
  .badge-failed   { background: rgba(248,81,73,.15); color: var(--red); }

  /* ── Cards ───────────────────────────────────────── */
  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1rem 1.2rem;
    margin-bottom: .75rem;
  }
  .card-title { font-weight: 600; margin-bottom: .3rem; }
  .card-desc  { color: var(--text-dim); font-size: .9rem; }
  .card a { color: var(--accent); text-decoration: none; }
  .card a:hover { text-decoration: underline; }

  /* ── Recommendations list ────────────────────────── */
  ol.recs { padding-left: 1.4rem; }
  ol.recs li { margin-bottom: .6rem; }

  /* ── Config blocks ───────────────────────────────── */
  .config-block {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1rem 1.2rem;
    margin-bottom: 1rem;
  }
  .config-block h3 {
    font-size: .95rem;
    margin-bottom: .5rem;
    color: var(--accent);
  }
  pre {
    background: #0d1117;
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: .8rem 1rem;
    overflow-x: auto;
    font-size: .82rem;
    line-height: 1.5;
    color: var(--text);
  }
  code { font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace; }

  footer {
    margin-top: 3rem;
    text-align: center;
    color: var(--text-dim);
    font-size: .8rem;
  }
</style>
</head>
<body>
<div class="container">
  <h1>&#x1F6E1; Validation Report</h1>
  <p class="subtitle">{{ report.cluster_summary }}</p>

  <!-- ── Stats ──────────────────────────────────── -->
  <div class="stats">
    <div class="stat-card pass">
      <div class="value">{{ report.passed }}</div>
      <div class="label">Passed</div>
    </div>
    <div class="stat-card fail">
      <div class="value">{{ report.failed }}</div>
      <div class="label">Failed</div>
    </div>
    <div class="stat-card warn">
      <div class="value">{{ report.warnings }}</div>
      <div class="label">Warnings</div>
    </div>
    <div class="stat-card fix">
      <div class="value">{{ report.fixes_applied }}</div>
      <div class="label">Fixes&nbsp;Applied</div>
    </div>
  </div>

  <!-- ── Validation Checks ──────────────────────── -->
  {% if report.checks %}
  <h2>Validation Checks</h2>
  <table>
    <thead>
      <tr>
        <th>Check</th>
        <th>Status</th>
        <th>Details</th>
        <th>Fix</th>
      </tr>
    </thead>
    <tbody>
      {% for check in report.checks %}
      <tr>
        <td>{{ check.name }}</td>
        <td><span class="badge badge-{{ check.status }}">{{ check.status }}</span></td>
        <td>{{ check.message }}</td>
        <td>
          {% if check.fix_applied %}
            <span class="badge badge-pass">applied</span> {{ check.fix_description }}
          {% else %}
            &mdash;
          {% endif %}
        </td>
      </tr>
      {% if check.fix_manifest %}
      <tr>
        <td colspan="4">
          <details>
            <summary style="cursor:pointer; color: var(--accent); font-size: .85rem;">Show fix manifest</summary>
            <pre><code>{{ check.fix_manifest }}</code></pre>
          </details>
        </td>
      </tr>
      {% endif %}
      {% endfor %}
    </tbody>
  </table>
  {% endif %}

  <!-- ── Remediation Steps ──────────────────────── -->
  {% if report.remediation_steps %}
  <h2>Remediation Steps</h2>
  {% for step in report.remediation_steps %}
  <div class="config-block">
    <h3>
      <span class="badge badge-{{ 'fail' if step.priority == 'high' else ('warn' if step.priority == 'medium' else 'skip') }}">{{ step.priority }}</span>
      {{ step.title }}
      {% if step.dashboard_id %}<span style="color: var(--text-dim); font-size: .85rem;"> &mdash; Dashboard ID: {{ step.dashboard_id }}</span>{% endif %}
    </h3>
    {% if step.description %}<p style="color: var(--text-dim); font-size: .88rem; margin: .5rem 0;">{{ step.description }}</p>{% endif %}
    {% if step.command %}
    <p style="font-size: .85rem; margin-bottom: .3rem; color: var(--accent);">Command:</p>
    <pre><code>{{ step.command }}</code></pre>
    {% endif %}
    {% if step.manifest %}
    <p style="font-size: .85rem; margin-bottom: .3rem; color: var(--accent);">Apply this manifest:</p>
    <pre><code>{{ step.manifest }}</code></pre>
    {% endif %}
    {% if step.dashboard_id and step.dashboard_title %}
    <div style="margin-top: .5rem;">
      <a href="https://grafana.com/grafana/dashboards/{{ step.dashboard_id }}" target="_blank">Import {{ step.dashboard_title }} (ID: {{ step.dashboard_id }}) from grafana.com &rarr;</a>
    </div>
    {% endif %}
  </div>
  {% endfor %}
  {% endif %}

  <!-- ── Dashboards to Import ───────────────────── -->
  {% if report.dashboards_to_import %}
  <h2>Recommended Dashboards to Import</h2>
  <table>
    <thead>
      <tr>
        <th>Dashboard</th>
        <th>ID</th>
        <th>Priority</th>
        <th>Import</th>
      </tr>
    </thead>
    <tbody>
      {% for d in report.dashboards_to_import %}
      <tr>
        <td>{{ d.title }}</td>
        <td>{{ d.dashboard_id }}</td>
        <td><span class="badge badge-{{ d.status }}">{{ d.status }}</span></td>
        <td><a href="https://grafana.com/grafana/dashboards/{{ d.dashboard_id }}" target="_blank">grafana.com &rarr;</a></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}

  <!-- ── Dashboards Imported ────────────────────── -->
  {% if report.dashboards_imported %}
  <h2>Dashboards Imported</h2>
  <table>
    <thead>
      <tr>
        <th>Dashboard</th>
        <th>ID</th>
        <th>Status</th>
        <th>URL</th>
      </tr>
    </thead>
    <tbody>
      {% for d in report.dashboards_imported %}
      <tr>
        <td>{{ d.title }}</td>
        <td>{{ d.dashboard_id }}</td>
        <td><span class="badge badge-{{ d.status }}">{{ d.status }}</span></td>
        <td>
          {% if d.url %}<a href="{{ d.url }}" target="_blank">Open</a>{% else %}&mdash;{% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}

  <!-- ── Suggested Dashboards (from plan) ───────── -->
  {% if plan and plan.dashboard_recommendations %}
  <h2>Suggested Community Dashboards</h2>
  {% for rec in plan.dashboard_recommendations %}
  <div class="card">
    <div class="card-title">{{ rec.title }} <span style="color: var(--text-dim);">(ID: {{ rec.dashboard_id }})</span></div>
    <div class="card-desc">{{ rec.description }}</div>
    {% if rec.archetype %}<div class="card-desc" style="margin-top: .3rem;">Archetype: <strong>{{ rec.archetype }}</strong></div>{% endif %}
    {% if rec.url %}<div style="margin-top: .3rem;"><a href="{{ rec.url }}" target="_blank">grafana.com &rarr;</a></div>{% endif %}
  </div>
  {% endfor %}
  {% endif %}

  <!-- ── Suggested Alerts (from plan) ───────────── -->
  {% if plan and plan.alerts %}
  <h2>Suggested Alert Rules</h2>
  {% for alert in plan.alerts %}
  <div class="config-block">
    <h3>{{ alert.alert_name }} <span class="badge badge-{{ 'warn' if alert.severity == 'warning' else 'fail' }}">{{ alert.severity }}</span></h3>
    <p style="color: var(--text-dim); font-size: .88rem; margin-bottom: .5rem;">{{ alert.summary }}</p>
    <pre><code>expr: {{ alert.expr }}
for:  {{ alert.for_duration }}
nodata_state: {{ alert.nodata_state }}</code></pre>
  </div>
  {% endfor %}
  {% endif %}

  <!-- ── Suggested Metrics (from plan) ──────────── -->
  {% if plan and plan.metrics %}
  <h2>Suggested Metrics</h2>
  <table>
    <thead>
      <tr>
        <th>Metric</th>
        <th>PromQL Query</th>
        <th>Resource</th>
      </tr>
    </thead>
    <tbody>
      {% for m in plan.metrics %}
      <tr>
        <td>{{ m.metric_name }}</td>
        <td><code>{{ m.query }}</code></td>
        <td>{{ m.resource }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}

  <!-- ── Remaining Recommendations ──────────────── -->
  {% if report.recommendations %}
  <h2>Action Items</h2>
  <ol class="recs">
    {% for rec in report.recommendations %}
    <li>{{ rec }}</li>
    {% endfor %}
  </ol>
  {% endif %}

  <footer>
    Generated by <strong>k8s-observability-agent</strong> &middot; {{ generated_at }}
  </footer>
</div>
</body>
</html>
